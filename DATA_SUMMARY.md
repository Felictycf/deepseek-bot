# 多时间框架数据汇总

## 📊 K线数据获取详情

系统现在支持 **4个时间框架** 的完整技术分析，每个时间框架都包含完整的技术指标计算。

### K线获取汇总表

| 时间框架 | 获取K线数 | 返回数据点 | 覆盖时长 | 用途 |
|---------|----------|-----------|---------|------|
| **3分钟** | 40根 | 30个 | 90分钟 (1.5小时) | 超短期动量、快速反转信号 |
| **15分钟** | 40根 | 24个 | 360分钟 (6小时) | 短期趋势、日内关键价位 |
| **1小时** | 60根 | 24个 | 1440分钟 (1天) | 日内趋势、支撑阻力位 |
| **4小时** | 60根 | 20个 | 4800分钟 (3.3天) | 中期趋势、大级别支撑阻力 |

**说明**：
- "获取K线数"：从交易所API获取的原始K线数量
- "返回数据点"：经过指标计算后，最终可用的数据点数量（因为EMA/MACD等指标需要预热期）
- TA-Lib指标计算需要一定的预热期，因此返回的有效数据点会少于获取的K线数

---

## 📈 技术指标详情

### 每个时间框架包含的完整指标列表

每个时间框架（3m, 15m, 1h, 4h）都包含以下技术指标：

| 指标类别 | 指标名称 | 参数 | 数据点数量 | 说明 |
|---------|---------|------|-----------|------|
| **价格序列** | OHLC | - | 与时间框架相同 | 开盘、最高、最低、收盘价 |
| **移动平均线** | EMA20 | 周期=20 | 与时间框架相同 | 20周期指数移动平均 |
| **移动平均线** | EMA50 | 周期=50 | 与时间框架相同 | 50周期指数移动平均 |
| **动量指标** | MACD快线 | 快=12, 慢=26 | 与时间框架相同 | MACD差离值 (DIF) |
| **动量指标** | MACD慢线 | 信号=9 | 与时间框架相同 | MACD信号线 (DEA) |
| **动量指标** | MACD柱状图 | - | 与时间框架相同 | MACD柱状图 (Histogram) |
| **相对强弱** | RSI(7) | 周期=7 | 与时间框架相同 | 7周期相对强弱指标 |
| **相对强弱** | RSI(14) | 周期=14 | 与时间框架相同 | 14周期相对强弱指标 |
| **波动率** | ATR(14) | 周期=14 | 与时间框架相同 | 14周期平均真实波幅 |
| **布林带** | 上轨 | 周期=20, 标准差=2 | 与时间框架相同 | 布林带上轨 |
| **布林带** | 中轨 | 周期=20 | 与时间框架相同 | 布林带中轨 (SMA20) |
| **布林带** | 下轨 | 周期=20, 标准差=2 | 与时间框架相同 | 布林带下轨 |
| **成交量** | Volume | - | 与时间框架相同 | 成交量 |
| **成交量** | Volume MA | 周期=20 | 与时间框架相同 | 成交量移动平均 |

**"与时间框架相同"含义**：
- 3分钟级别：每个指标有 **30个数据点**
- 15分钟级别：每个指标有 **24个数据点**
- 1小时级别：每个指标有 **24个数据点**
- 4小时级别：每个指标有 **20个数据点**

---

## 🔍 具体数据点数量统计

### 3分钟级别（超短期）
```
获取K线：40根
返回数据点：30个
覆盖时长：90分钟

每个指标的数据点数：
- 价格序列 (OHLC): 30个
- EMA20: 30个
- EMA50: 30个
- MACD快线: 30个
- MACD慢线: 30个
- MACD柱状图: 30个
- RSI(7): 30个
- RSI(14): 30个
- ATR(14): 30个
- 布林带上轨: 30个
- 布林带中轨: 30个
- 布林带下轨: 30个
- 成交量: 30个
- 成交量均线: 30个

总计：14个指标 × 30个数据点 = 420个数据点
```

### 15分钟级别（短期）
```
获取K线：40根
返回数据点：24个
覆盖时长：6小时

每个指标的数据点数：
- 价格序列 (OHLC): 24个
- EMA20: 24个
- EMA50: 24个
- MACD快线: 24个
- MACD慢线: 24个
- MACD柱状图: 24个
- RSI(7): 24个
- RSI(14): 24个
- ATR(14): 24个
- 布林带上轨: 24个
- 布林带中轨: 24个
- 布林带下轨: 24个
- 成交量: 24个
- 成交量均线: 24个

总计：14个指标 × 24个数据点 = 336个数据点
```

### 1小时级别（中短期）
```
获取K线：60根
返回数据点：24个
覆盖时长：1天 (24小时)

每个指标的数据点数：
- 价格序列 (OHLC): 24个
- EMA20: 24个
- EMA50: 24个
- MACD快线: 24个
- MACD慢线: 24个
- MACD柱状图: 24个
- RSI(7): 24个
- RSI(14): 24个
- ATR(14): 24个
- 布林带上轨: 24个
- 布林带中轨: 24个
- 布林带下轨: 24个
- 成交量: 24个
- 成交量均线: 24个

总计：14个指标 × 24个数据点 = 336个数据点
```

### 4小时级别（中长期）
```
获取K线：60根
返回数据点：20个
覆盖时长：3.3天 (80小时)

每个指标的数据点数：
- 价格序列 (OHLC): 20个
- EMA20: 20个
- EMA50: 20个
- MACD快线: 20个
- MACD慢线: 20个
- MACD柱状图: 20个
- RSI(7): 20个
- RSI(14): 20个
- ATR(14): 20个
- 布林带上轨: 20个
- 布林带中轨: 20个
- 布林带下轨: 20个
- 成交量: 20个
- 成交量均线: 20个

总计：14个指标 × 20个数据点 = 280个数据点
```

---

## 💡 多时间框架分析优势

### 1. 趋势共振分析
- **多周期同向**：当所有时间框架趋势一致时，信号强度最高
- **背离识别**：短周期与长周期趋势相反时，可能是回调或反转信号

### 2. 支撑阻力位识别
- **长周期关键价位**：4小时级别的支撑阻力更可靠
- **多周期重合**：多个时间框架的关键价位重合 = 强支撑/阻力

### 3. 入场时机优化
- **长周期定方向**：4小时/1小时确定大趋势
- **短周期找时机**：15分钟/3分钟寻找最佳入场点

### 4. 风险控制
- **多维度验证**：避免单一时间框架误判
- **动态止损**：根据不同周期的ATR调整止损距离

---

## 🎯 数据使用建议

### AI分析时的优先级
1. **先看长周期（4h）**：确定大趋势方向
2. **再看中周期（1h）**：判断日内趋势
3. **后看短周期（15m）**：寻找入场时机
4. **最后看超短期（3m）**：精确入场点位

### 指标组合建议
- **趋势判断**：EMA20/EMA50 排列
- **动量确认**：MACD 金叉死叉
- **超买超卖**：RSI(7) 和 RSI(14)
- **波动率**：ATR(14) 判断市场活跃度
- **压力支撑**：布林带上下轨

### 信号强度判断
- **强信号**：多周期指标共振 + 成交量配合
- **中信号**：2-3个周期指标一致
- **弱信号**：仅单一周期指标触发

---

## 📌 技术实现说明

### 数据获取流程
```python
# market_data.py 中的实现
1. 获取原始K线数据（通过CCXT从币安API）
2. 转换为pandas DataFrame
3. 调用 TA-Lib 计算各项技术指标
4. 裁剪掉预热期数据，返回有效数据点
5. 封装为统一的数据结构返回给AI
```

### 为什么数据点少于K线数？
- **EMA50** 需要至少50个K线才能计算准确值
- **MACD** 需要26个K线（慢线周期）+ 9个K线（信号线）
- **RSI** 需要14-15个K线预热
- 因此系统会多获取一些K线，计算后只返回稳定的数据点

### 数据新鲜度
- 每次调用 `get_btc_complete_data()` 都会实时获取最新数据
- 3分钟级别：最新数据延迟 < 1分钟
- 其他级别：随交易所K线周期更新

---

## 🚀 总数据量统计

### 单次分析总数据点
```
3分钟：420个数据点
15分钟：336个数据点
1小时：336个数据点
4小时：280个数据点
----------------------------
总计：1372个数据点

外加：
- 持仓量数据：1个
- 资金费率数据：1个
- 当前价格：1个
- 多时间框架涨跌幅：4个
----------------------------
完整数据集：约1378个数据点
```

### AI输入Token估算
- 完整市场数据 prompt：约 3000-4000 tokens
- System prompt：约 800-1000 tokens
- AI响应（CoT + JSON）：约 500-800 tokens
- **单次分析总消耗**：约 4500-6000 tokens

### 成本估算（DeepSeek API）
- 单次调用：约 0.0005 - 0.0008 USD
- 每小时12次（5分钟间隔）：约 0.006 - 0.01 USD
- 每天（288次）：约 0.15 - 0.25 USD
- 每月（8640次）：约 4.5 - 7.5 USD

---

**最后更新时间**：2025-01-01
**系统版本**：Multi-Timeframe Analysis v1.0
